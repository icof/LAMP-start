# Workflow pour gÃ©nÃ©rer et dÃ©ployer la documentation
# GÃ©nÃ¨re automatiquement la doc avec phpDocumentor

name: ğŸ“š Documentation

on:
  push:
    branches: [ main ]
    paths:
      - 'site/**'        # Seulement si on modifie le code
      - 'README.md'       # Ou le README
  workflow_dispatch:      # Manuel

jobs:
  documentation:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ RÃ©cupÃ©rer le code
        uses: actions/checkout@v4
        
      - name: ğŸ˜ Installer PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
          
      - name: ğŸ“– GÃ©nÃ©rer la documentation
        run: |
          # VÃ©rifier si phpDocumentor existe
          if [ -f phpDocumentor.phar ]; then
            echo "ğŸ”§ GÃ©nÃ©ration de la documentation..."
            php phpDocumentor.phar run -d ./site -t ./documentation
            echo "âœ… Documentation gÃ©nÃ©rÃ©e !"
          else
            echo "âš ï¸ phpDocumentor.phar non trouvÃ©"
            # CrÃ©er une doc basique
            mkdir -p documentation
            echo "<h1>Documentation non disponible</h1>" > documentation/index.html
          fi
          
      - name: ğŸ“¤ DÃ©ployer sur GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        if: github.ref == 'refs/heads/main'  # Seulement sur main
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./documentation
          
      - name: ğŸ’¬ Commenter la PR avec le lien
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: 'ğŸ“š Documentation mise Ã  jour ! Voir : https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}'
            })
